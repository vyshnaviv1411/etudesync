========================================================================
üî• ASSESSARENA SQL FIX - IMMEDIATE ACTION REQUIRED
========================================================================

ERROR YOU'RE SEEING:
  SQLSTATE[42S22]: Column not found: 1054 Unknown column 'code' in 'field list'

ROOT CAUSE:
  Your database is missing required columns that the PHP code expects.

========================================================================
‚úÖ SOLUTION (Choose ONE method below)
========================================================================

METHOD 1: ONE-CLICK WEB FIX (EASIEST - DO THIS)
------------------------------------------------
1. Open your browser
2. Go to: http://localhost/etudesync/public/admin/fix_assessarena_now.php
3. Click "FIX DATABASE NOW"
4. Wait for success message
5. Go to AssessArena and test

‚úÖ This will automatically:
   - Add missing columns (code, time_limit_minutes, shuffle_questions)
   - Generate unique codes for existing quizzes
   - Set proper constraints
   - Verify the fix

========================================================================

METHOD 2: RUN DIAGNOSTIC FIRST (If you want to see what's wrong)
-----------------------------------------------------------------
1. Go to: http://localhost/etudesync/public/admin/check_assessarena.php
2. Review what's missing
3. Click "FIX DATABASE NOW" button
4. Wait for completion

========================================================================

METHOD 3: MANUAL SQL FIX (If web methods don't work)
-----------------------------------------------------
1. Open phpMyAdmin: http://localhost/phpmyadmin
2. Select database: etudesync
3. Click "SQL" tab
4. Copy and paste this SQL:

---START SQL---
USE etudesync;

-- Add missing columns
ALTER TABLE quizzes ADD COLUMN code VARCHAR(12) NULL AFTER id;
ALTER TABLE quizzes ADD COLUMN time_limit_minutes INT NULL AFTER title;
ALTER TABLE quizzes ADD COLUMN shuffle_questions BOOLEAN DEFAULT FALSE;

-- Generate codes for existing quizzes
UPDATE quizzes
SET code = UPPER(SUBSTRING(MD5(CONCAT(id, RAND(), NOW())), 1, 8))
WHERE code IS NULL OR code = '';

-- Set constraints
ALTER TABLE quizzes MODIFY code VARCHAR(12) NOT NULL;
ALTER TABLE quizzes ADD UNIQUE INDEX idx_code_unique (code);

-- Verify
DESCRIBE quizzes;
---END SQL---

5. Click "Go"
6. Ignore "Duplicate column" errors (means column already exists)

========================================================================
üß™ VERIFY THE FIX WORKED
========================================================================

After running the fix:

1. Go to AssessArena
2. Click "Create Quiz"
3. Enter title: "Test Quiz"
4. Set time limit: 30 (optional)
5. Click "Create"

‚úÖ Should work without errors
‚úÖ Should get a quiz code like "A3F7B2D8"
‚úÖ Can now load quiz using code

========================================================================
üìä WHAT THE FIX DOES
========================================================================

BEFORE (Broken):
  quizzes table:
  ‚îú‚îÄ‚îÄ id
  ‚îú‚îÄ‚îÄ created_at
  ‚îî‚îÄ‚îÄ (missing code, time_limit_minutes, shuffle_questions)

  ‚ùå PHP code tries to use 'code' ‚Üí ERROR
  ‚ùå PHP code tries to use 'time_limit_minutes' ‚Üí ERROR

AFTER (Fixed):
  quizzes table:
  ‚îú‚îÄ‚îÄ id
  ‚îú‚îÄ‚îÄ code ‚Üê ADDED (unique quiz identifier)
  ‚îú‚îÄ‚îÄ owner_id
  ‚îú‚îÄ‚îÄ title
  ‚îú‚îÄ‚îÄ time_limit_minutes ‚Üê ADDED (optional timer)
  ‚îú‚îÄ‚îÄ shuffle_questions ‚Üê ADDED (randomize questions)
  ‚îú‚îÄ‚îÄ created_at
  ‚îî‚îÄ‚îÄ updated_at

  ‚úÖ PHP code can use 'code' ‚Üí WORKS
  ‚úÖ PHP code can use 'time_limit_minutes' ‚Üí WORKS
  ‚úÖ All CRUD operations work

========================================================================
üéØ EXPECTED RESULT
========================================================================

Quiz Creation Response (Should see this in Network tab):
{
  "ok": true,
  "quiz_id": 123,
  "code": "A3F7B2D8",
  "msg": "Quiz created successfully"
}

‚úÖ No more SQL errors
‚úÖ Quiz code generated
‚úÖ Time limit works

========================================================================
‚ö†Ô∏è IF STILL NOT WORKING AFTER FIX
========================================================================

1. Clear browser cache (Ctrl+Shift+Delete)
2. Restart XAMPP (Apache + MySQL)
3. Check browser console for JavaScript errors (F12)
4. Verify columns exist:
   - Go to phpMyAdmin
   - Select etudesync database
   - Click quizzes table
   - Click "Structure" tab
   - Verify you see: code, time_limit_minutes, shuffle_questions

5. Run diagnostic again:
   http://localhost/etudesync/public/admin/check_assessarena.php

========================================================================
üìû STILL STUCK?
========================================================================

If errors persist after running the fix:

1. Screenshot the error from browser console (F12 ‚Üí Console)
2. Screenshot phpMyAdmin showing quizzes table structure
3. Check if other tables are missing (questions, attempts)
4. Verify PHP version (7.4+ required)
5. Check MySQL error log

========================================================================
üöÄ QUICK START
========================================================================

Just do this RIGHT NOW:

1. Click: http://localhost/etudesync/public/admin/fix_assessarena_now.php
2. Wait 10 seconds
3. Go to AssessArena
4. Create a quiz
5. Done!

========================================================================
